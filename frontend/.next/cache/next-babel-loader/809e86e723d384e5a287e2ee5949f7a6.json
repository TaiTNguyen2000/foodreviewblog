{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\HUFLIT\\\\Nam 3\\\\HK2\\\\CNPMNC\\\\foodie-blog\\\\frontend\\\\components\\\\crud\\\\BlogCreate.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Link from 'next/link';\nimport { useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport dynamic from 'next/dynamic';\nimport { withRouter } from 'next/router';\nimport { getCookie, isAuth } from '../../actions/auth';\nimport { getCategories } from '../../actions/category';\nimport { getTags } from '../../actions/tag';\nimport { createBlog } from '../../actions/blog';\nvar ReactQuill = dynamic(_c = function _c() {\n  return import('react-quill');\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('react-quill')];\n    },\n    modules: ['react-quill']\n  }\n});\n_c2 = ReactQuill;\nimport '../../node_modules/react-quill/dist/quill.snow.css';\nimport { QuillModules, QuillFormats } from '../../helpers/quill';\n\nvar CreateBlog = function CreateBlog(_ref) {\n  _s();\n\n  var router = _ref.router;\n\n  var blogFromLS = function blogFromLS() {\n    if (false) {\n      return false;\n    }\n\n    if (localStorage.getItem('blog')) {\n      return JSON.parse(localStorage.getItem('blog'));\n    } else {\n      return false;\n    }\n  };\n\n  var _useState = useState([]),\n      categories = _useState[0],\n      setCategories = _useState[1];\n\n  var _useState2 = useState([]),\n      tags = _useState2[0],\n      setTags = _useState2[1];\n\n  var _useState3 = useState([]),\n      checked = _useState3[0],\n      setChecked = _useState3[1]; // categories\n\n\n  var _useState4 = useState([]),\n      checkedTag = _useState4[0],\n      setCheckedTag = _useState4[1]; // tags\n\n\n  var _useState5 = useState(blogFromLS()),\n      body = _useState5[0],\n      setBody = _useState5[1];\n\n  var _useState6 = useState({\n    error: '',\n    sizeError: '',\n    success: '',\n    formData: '',\n    title: '',\n    hidePublishButton: false\n  }),\n      values = _useState6[0],\n      setValues = _useState6[1];\n\n  var error = values.error,\n      sizeError = values.sizeError,\n      success = values.success,\n      formData = values.formData,\n      title = values.title,\n      hidePublishButton = values.hidePublishButton;\n  var token = getCookie('token');\n  useEffect(function () {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      formData: new FormData()\n    }));\n    initCategories();\n    initTags();\n  }, [router]);\n\n  var initCategories = function initCategories() {\n    getCategories().then(function (data) {\n      if (data.error) {\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          error: data.error\n        }));\n      } else {\n        setCategories(data);\n      }\n    });\n  };\n\n  var initTags = function initTags() {\n    getTags().then(function (data) {\n      if (data.error) {\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          error: data.error\n        }));\n      } else {\n        setTags(data);\n      }\n    });\n  };\n\n  var publishBlog = function publishBlog(e) {\n    e.preventDefault(); // console.log('ready to publishBlog');\n\n    createBlog(formData, token).then(function (data) {\n      if (data.error) {\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          error: data.error\n        }));\n      } else {\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          title: '',\n          error: '',\n          success: \"A new blog titled \\\"\".concat(data.title, \"\\\" is created\")\n        }));\n        setBody('');\n        setCategories([]);\n        setTags([]);\n      }\n    });\n  };\n\n  var handleChange = function handleChange(name) {\n    return function (e) {\n      var _objectSpread2;\n\n      // console.log(e.target.value);\n      var value = name === 'photo' ? e.target.files[0] : e.target.value;\n      formData.set(name, value);\n      setValues(_objectSpread(_objectSpread({}, values), {}, (_objectSpread2 = {}, _defineProperty(_objectSpread2, name, value), _defineProperty(_objectSpread2, \"formData\", formData), _defineProperty(_objectSpread2, \"error\", ''), _objectSpread2)));\n    };\n  };\n\n  var handleBody = function handleBody(e) {\n    // console.log(e);\n    setBody(e);\n    formData.set('body', e);\n\n    if (true) {\n      localStorage.setItem('blog', JSON.stringify(e));\n    }\n  };\n\n  var handleToggle = function handleToggle(c) {\n    return function () {\n      setValues(_objectSpread(_objectSpread({}, values), {}, {\n        error: ''\n      })); // return the first index or -1\n\n      var clickedCategory = checked.indexOf(c);\n\n      var all = _toConsumableArray(checked);\n\n      if (clickedCategory === -1) {\n        all.push(c);\n      } else {\n        all.splice(clickedCategory, 1);\n      }\n\n      console.log(all);\n      setChecked(all);\n      formData.set('categories', all);\n    };\n  };\n\n  var handleTagsToggle = function handleTagsToggle(t) {\n    return function () {\n      setValues(_objectSpread(_objectSpread({}, values), {}, {\n        error: ''\n      })); // return the first index or -1\n\n      var clickedTag = checked.indexOf(t);\n\n      var all = _toConsumableArray(checkedTag);\n\n      if (clickedTag === -1) {\n        all.push(t);\n      } else {\n        all.splice(clickedTag, 1);\n      }\n\n      console.log(all);\n      setCheckedTag(all);\n      formData.set('tags', all);\n    };\n  };\n\n  var showCategories = function showCategories() {\n    return categories && categories.map(function (c, i) {\n      return __jsx(\"li\", {\n        key: i,\n        className: \"list-unstyled\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 9\n        }\n      }, __jsx(\"input\", {\n        onChange: handleToggle(c._id),\n        type: \"checkbox\",\n        className: \"mr-2\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 11\n        }\n      }), __jsx(\"label\", {\n        className: \"form-check-label\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 11\n        }\n      }, c.name));\n    });\n  };\n\n  var showTags = function showTags() {\n    return tags && tags.map(function (t, i) {\n      return __jsx(\"li\", {\n        key: i,\n        className: \"list-unstyled\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 9\n        }\n      }, __jsx(\"input\", {\n        onChange: handleTagsToggle(t._id),\n        type: \"checkbox\",\n        className: \"mr-2\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 11\n        }\n      }), __jsx(\"label\", {\n        className: \"form-check-label\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 11\n        }\n      }, t.name));\n    });\n  };\n\n  var showError = function showError() {\n    return __jsx(\"div\", {\n      className: \"alert alert-danger\",\n      style: {\n        display: error ? '' : 'none'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 5\n      }\n    }, error);\n  };\n\n  var showSuccess = function showSuccess() {\n    return __jsx(\"div\", {\n      className: \"alert alert-success\",\n      style: {\n        display: success ? '' : 'none'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 5\n      }\n    }, success);\n  };\n\n  var createBlogForm = function createBlogForm() {\n    return __jsx(\"form\", {\n      onSubmit: publishBlog,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 7\n      }\n    }, __jsx(\"div\", {\n      className: \"form-group\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 9\n      }\n    }, __jsx(\"label\", {\n      className: \"text-muted\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 11\n      }\n    }, \"Title\"), __jsx(\"input\", {\n      type: \"text\",\n      className: \"form-control\",\n      value: title,\n      onChange: handleChange('title'),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 11\n      }\n    })), __jsx(\"div\", {\n      className: \"form-group\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 9\n      }\n    }, __jsx(ReactQuill, {\n      modules: QuillModules,\n      formats: QuillFormats,\n      value: body,\n      placeholder: \"Write something amazing...\",\n      onChange: handleBody,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 11\n      }\n    })), __jsx(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 9\n      }\n    }, __jsx(\"button\", {\n      type: \"submit\",\n      className: \"btn btn-primary\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 11\n      }\n    }, \"Publish\")));\n  };\n\n  return __jsx(\"div\", {\n    className: \"container-fluid pb-5\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"row\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"col-md-8\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 9\n    }\n  }, createBlogForm(), __jsx(\"div\", {\n    className: \"pt-3\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 11\n    }\n  }, showError(), showSuccess())), __jsx(\"div\", {\n    className: \"col-md-4\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"form-group pb-2\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 13\n    }\n  }, __jsx(\"h5\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 15\n    }\n  }, \"Featured image\"), __jsx(\"hr\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 15\n    }\n  }), __jsx(\"small\", {\n    className: \"text-muted\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 15\n    }\n  }, \"Max size: 1mb\"), __jsx(\"br\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 15\n    }\n  }), __jsx(\"label\", {\n    className: \"btn btn-outline-info\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 15\n    }\n  }, \"Upload featured image\", __jsx(\"input\", {\n    onChange: handleChange('photo'),\n    type: \"file\",\n    accept: \"image/*\",\n    hidden: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 17\n    }\n  })))), __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 11\n    }\n  }, __jsx(\"h5\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 13\n    }\n  }, \"Categories\"), __jsx(\"hr\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 13\n    }\n  }), __jsx(\"ul\", {\n    style: {\n      maxHeight: '200px',\n      overflowY: 'scroll'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 13\n    }\n  }, showCategories())), __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 11\n    }\n  }, __jsx(\"h5\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 13\n    }\n  }, \"Tags\"), __jsx(\"hr\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 13\n    }\n  }), __jsx(\"ul\", {\n    style: {\n      maxHeight: '200px',\n      overflowY: 'scroll'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 13\n    }\n  }, showTags())))));\n};\n\n_s(CreateBlog, \"3NkPSaqN+6mSmHHqOFCJgkR6IdQ=\");\n\n_c3 = CreateBlog;\nexport default _c4 = withRouter(CreateBlog);\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"ReactQuill$dynamic\");\n$RefreshReg$(_c2, \"ReactQuill\");\n$RefreshReg$(_c3, \"CreateBlog\");\n$RefreshReg$(_c4, \"%default%\");","map":{"version":3,"sources":["D:/HUFLIT/Nam 3/HK2/CNPMNC/foodie-blog/frontend/components/crud/BlogCreate.js"],"names":["Link","useState","useEffect","Router","dynamic","withRouter","getCookie","isAuth","getCategories","getTags","createBlog","ReactQuill","ssr","QuillModules","QuillFormats","CreateBlog","router","blogFromLS","localStorage","getItem","JSON","parse","categories","setCategories","tags","setTags","checked","setChecked","checkedTag","setCheckedTag","body","setBody","error","sizeError","success","formData","title","hidePublishButton","values","setValues","token","FormData","initCategories","initTags","then","data","publishBlog","e","preventDefault","handleChange","name","value","target","files","set","handleBody","setItem","stringify","handleToggle","c","clickedCategory","indexOf","all","push","splice","console","log","handleTagsToggle","t","clickedTag","showCategories","map","i","_id","showTags","showError","display","showSuccess","createBlogForm","maxHeight","overflowY"],"mappings":"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","sourcesContent":["import Link from 'next/link';\r\nimport { useState, useEffect } from 'react';\r\nimport Router from 'next/router';\r\nimport dynamic from 'next/dynamic';\r\nimport { withRouter } from 'next/router';\r\nimport { getCookie, isAuth } from '../../actions/auth';\r\nimport { getCategories } from '../../actions/category';\r\nimport { getTags } from '../../actions/tag';\r\nimport { createBlog } from '../../actions/blog';\r\nconst ReactQuill = dynamic(() => import('react-quill'), { ssr: false });\r\nimport '../../node_modules/react-quill/dist/quill.snow.css';\r\nimport { QuillModules, QuillFormats } from '../../helpers/quill';\r\n\r\nconst CreateBlog = ({ router }) => {\r\n  const blogFromLS = () => {\r\n    if (typeof window === 'undefined') {\r\n      return false;\r\n    }\r\n\r\n    if (localStorage.getItem('blog')) {\r\n      return JSON.parse(localStorage.getItem('blog'));\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const [categories, setCategories] = useState([]);\r\n  const [tags, setTags] = useState([]);\r\n\r\n  const [checked, setChecked] = useState([]); // categories\r\n  const [checkedTag, setCheckedTag] = useState([]); // tags\r\n\r\n  const [body, setBody] = useState(blogFromLS());\r\n  const [values, setValues] = useState({\r\n    error: '',\r\n    sizeError: '',\r\n    success: '',\r\n    formData: '',\r\n    title: '',\r\n    hidePublishButton: false,\r\n  });\r\n\r\n  const { error, sizeError, success, formData, title, hidePublishButton } =\r\n    values;\r\n  const token = getCookie('token');\r\n\r\n  useEffect(() => {\r\n    setValues({ ...values, formData: new FormData() });\r\n    initCategories();\r\n    initTags();\r\n  }, [router]);\r\n\r\n  const initCategories = () => {\r\n    getCategories().then((data) => {\r\n      if (data.error) {\r\n        setValues({ ...values, error: data.error });\r\n      } else {\r\n        setCategories(data);\r\n      }\r\n    });\r\n  };\r\n\r\n  const initTags = () => {\r\n    getTags().then((data) => {\r\n      if (data.error) {\r\n        setValues({ ...values, error: data.error });\r\n      } else {\r\n        setTags(data);\r\n      }\r\n    });\r\n  };\r\n\r\n  const publishBlog = (e) => {\r\n    e.preventDefault();\r\n    // console.log('ready to publishBlog');\r\n    createBlog(formData, token).then((data) => {\r\n      if (data.error) {\r\n        setValues({ ...values, error: data.error });\r\n      } else {\r\n        setValues({\r\n          ...values,\r\n          title: '',\r\n          error: '',\r\n          success: `A new blog titled \"${data.title}\" is created`,\r\n        });\r\n        setBody('');\r\n        setCategories([]);\r\n        setTags([]);\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleChange = (name) => (e) => {\r\n    // console.log(e.target.value);\r\n    const value = name === 'photo' ? e.target.files[0] : e.target.value;\r\n    formData.set(name, value);\r\n    setValues({ ...values, [name]: value, formData, error: '' });\r\n  };\r\n\r\n  const handleBody = (e) => {\r\n    // console.log(e);\r\n    setBody(e);\r\n    formData.set('body', e);\r\n    if (typeof window !== 'undefined') {\r\n      localStorage.setItem('blog', JSON.stringify(e));\r\n    }\r\n  };\r\n\r\n  const handleToggle = (c) => () => {\r\n    setValues({ ...values, error: '' });\r\n    // return the first index or -1\r\n    const clickedCategory = checked.indexOf(c);\r\n    const all = [...checked];\r\n\r\n    if (clickedCategory === -1) {\r\n      all.push(c);\r\n    } else {\r\n      all.splice(clickedCategory, 1);\r\n    }\r\n    console.log(all);\r\n    setChecked(all);\r\n    formData.set('categories', all);\r\n  };\r\n\r\n  const handleTagsToggle = (t) => () => {\r\n    setValues({ ...values, error: '' });\r\n    // return the first index or -1\r\n    const clickedTag = checked.indexOf(t);\r\n    const all = [...checkedTag];\r\n\r\n    if (clickedTag === -1) {\r\n      all.push(t);\r\n    } else {\r\n      all.splice(clickedTag, 1);\r\n    }\r\n    console.log(all);\r\n    setCheckedTag(all);\r\n    formData.set('tags', all);\r\n  };\r\n\r\n  const showCategories = () => {\r\n    return (\r\n      categories &&\r\n      categories.map((c, i) => (\r\n        <li key={i} className='list-unstyled'>\r\n          <input\r\n            onChange={handleToggle(c._id)}\r\n            type='checkbox'\r\n            className='mr-2'\r\n          />\r\n          <label className='form-check-label'>{c.name}</label>\r\n        </li>\r\n      ))\r\n    );\r\n  };\r\n\r\n  const showTags = () => {\r\n    return (\r\n      tags &&\r\n      tags.map((t, i) => (\r\n        <li key={i} className='list-unstyled'>\r\n          <input\r\n            onChange={handleTagsToggle(t._id)}\r\n            type='checkbox'\r\n            className='mr-2'\r\n          />\r\n          <label className='form-check-label'>{t.name}</label>\r\n        </li>\r\n      ))\r\n    );\r\n  };\r\n\r\n  const showError = () => (\r\n    <div\r\n      className='alert alert-danger'\r\n      style={{ display: error ? '' : 'none' }}\r\n    >\r\n      {error}\r\n    </div>\r\n  );\r\n\r\n  const showSuccess = () => (\r\n    <div\r\n      className='alert alert-success'\r\n      style={{ display: success ? '' : 'none' }}\r\n    >\r\n      {success}\r\n    </div>\r\n  );\r\n\r\n  const createBlogForm = () => {\r\n    return (\r\n      <form onSubmit={publishBlog}>\r\n        <div className='form-group'>\r\n          <label className='text-muted'>Title</label>\r\n          <input\r\n            type='text'\r\n            className='form-control'\r\n            value={title}\r\n            onChange={handleChange('title')}\r\n          />\r\n        </div>\r\n\r\n        <div className='form-group'>\r\n          <ReactQuill\r\n            modules={QuillModules}\r\n            formats={QuillFormats}\r\n            value={body}\r\n            placeholder='Write something amazing...'\r\n            onChange={handleBody}\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <button type='submit' className='btn btn-primary'>\r\n            Publish\r\n          </button>\r\n        </div>\r\n      </form>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className='container-fluid pb-5'>\r\n      <div className='row'>\r\n        <div className='col-md-8'>\r\n          {createBlogForm()}\r\n          <div className='pt-3'>\r\n            {showError()}\r\n            {showSuccess()}\r\n          </div>\r\n        </div>\r\n\r\n        <div className='col-md-4'>\r\n          <div>\r\n            <div className='form-group pb-2'>\r\n              <h5>Featured image</h5>\r\n              <hr />\r\n\r\n              <small className='text-muted'>Max size: 1mb</small>\r\n              <br />\r\n              <label className='btn btn-outline-info'>\r\n                Upload featured image\r\n                <input\r\n                  onChange={handleChange('photo')}\r\n                  type='file'\r\n                  accept='image/*'\r\n                  hidden\r\n                />\r\n              </label>\r\n            </div>\r\n          </div>\r\n          <div>\r\n            <h5>Categories</h5>\r\n            <hr />\r\n\r\n            <ul style={{ maxHeight: '200px', overflowY: 'scroll' }}>\r\n              {showCategories()}\r\n            </ul>\r\n          </div>\r\n          <div>\r\n            <h5>Tags</h5>\r\n            <hr />\r\n            <ul style={{ maxHeight: '200px', overflowY: 'scroll' }}>\r\n              {showTags()}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default withRouter(CreateBlog);\r\n"]},"metadata":{},"sourceType":"module"}